<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Savegame - Bar Birsa Super League Official App</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="src/styles.css" />
</head>
<!-- (Rimossa intestazione grafica avanzata per uniformare alla versione semplice) -->
<body>
<header class="global-top-bar site-nav">
  <div class="brand"><span class="dot"></span><span>BBSL</span></div>
  <nav aria-label="Navigazione principale">
    <a href="home.html">Home</a>
    <a href="clubs.html">Club</a>
    <a href="competizioni.html">Competizioni</a>
    <a href="listone.html">Listone</a>
    <a href="asta.html">Asta</a>
  <a href="albo.html">Albo d'oro</a>
  <a href="index.html">Savegame</a>
  </nav>
</header>
<main>
  <section class="hero fade-in" style="background:linear-gradient(100deg,var(--comp-primary,#0d1522),var(--comp-secondary,#334155)); color:#fff; border:1px solid rgba(255,255,255,0.18); box-shadow:0 6px 18px -4px rgba(0,0,0,0.55); position:relative; overflow:hidden;">
  <img src="media/BBSL_logo_nero.png" alt="Logo BBSL (notturno)" style="position:absolute; top:10px; right:12px; width:86px; max-width:25%; height:auto; filter:drop-shadow(0 2px 6px rgba(0,0,0,0.6)); opacity:.95;" />
    <h1 style="text-shadow:0 2px 6px rgba(0,0,0,0.35); letter-spacing:.5px; padding-right:120px;">Gestione Fantacalcio Evoluta</h1>
    <p class="subtitle">Controlla aste, contratti, budget e competizioni in un'unica interfaccia veloce. Esporta, sperimenta in sandbox e mantieni lo storico completo.</p>
    <div class="stat-grid" id="homeStats">
      <div class="stat-card"><h3>Giocatori</h3><div class="value" id="statPlayers">-</div><div class="delta" id="deltaPlayers">&nbsp;</div></div>
      <div class="stat-card"><h3>Club</h3><div class="value" id="statClubs">-</div><div class="delta" id="deltaClubs">&nbsp;</div></div>
      <div class="stat-card"><h3>Contratti Attivi</h3><div class="value" id="statContracts">-</div><div class="delta" id="deltaContracts">&nbsp;</div></div>
      <div class="stat-card"><h3>Ingaggi Totali</h3><div class="value" id="statWage">-</div><div class="delta" id="deltaWage">&nbsp;</div></div>
    </div>
  </section>
  <section class="panel accented">
    <h2 class="border-accent">Savegame & Dati</h2>
    <div class="toolbar">
      <div class="toolbar-group">
        <button id="exportBtn" class="btn-lg">Esporta JSON</button>
        <label class="import-label btn-lg" style="margin:4px 0;">Importa JSON <input type="file" id="importFile" accept="application/json" hidden></label>
        <button id="resetBtn" class="btn-danger btn-lg">Reset</button>
      </div>
    </div>
    <p class="text-muted" style="margin-top:4px;font-size:13px;">L'esportazione include sandbox e meta. Il reset elimina tutto il localStorage dell'app.</p>
  </section>
  <section class="panel">
    <h2 class="border-accent">Avvio rapido</h2>
    <ol style="margin:8px 0 0 18px; line-height:1.5; font-size:14px;">
      <li>Importa (o crea) i giocatori dal Listone.</li>
      <li>Crea / verifica club e colori.</li>
      <li>Esegui l'asta registrando gli acquisti.</li>
      <li>Gestisci contratti e svincoli nelle pagine club.</li>
      <li>Monitora budget e transazioni.</li>
    </ol>
  </section>
</main>
<script type="module">
import { ensureAuth } from './src/js/auth.js';
import { initData, exportData, importData, resetToDefault } from './src/js/storage.js';
import { uiAlert, uiConfirm, announce } from './src/js/ui.js';
// Redirect automatico alla Home dopo autenticazione (index usato solo come gestione Savegame secondaria)
(async () => {
  await ensureAuth();
  // Se non c'è ancora hash specifico (#stay qui) reindirizza
  // Redirect automatico disattivato: la pagina Savegame ora è accessibile direttamente.
  let appData = await initData();
  // Evidenzia link corrente nella barra globale
  (function markCurrent(){ const cur=location.pathname.split('/').pop().toLowerCase(); document.querySelectorAll('.site-nav nav a').forEach(a=>{ if(a.getAttribute('href').toLowerCase()===cur){ a.classList.add('active'); a.setAttribute('aria-current','page'); } }); })();
  // Populate stats
  function refreshStats(){
    const players = appData.players.length;
    const clubs = appData.clubs.length;
    const contracts = appData.clubs.reduce((sum,c)=> sum + c.roster.filter(r=>r.status==='active').length,0);
    const wage = appData.clubs.reduce((sum,c)=> sum + (c.wageTotal||0),0);
    document.getElementById('statPlayers').textContent = players;
    document.getElementById('statClubs').textContent = clubs;
    document.getElementById('statContracts').textContent = contracts;
    document.getElementById('statWage').textContent = wage;
  }
  refreshStats();
  const exportBtn = document.getElementById('exportBtn');
  exportBtn.addEventListener('click', () => { 
    exportData(appData); 
    announce('Esportazione completata'); 
  });
  document.getElementById('importFile').addEventListener('change', async (e) => {
    if (e.target.files[0]) {
      try {
        appData = await importData(e.target.files[0]);
        refreshStats();
        await uiAlert('Import riuscito!');
        announce('Import riuscito');
      } catch(err) { 
        uiAlert('Errore import: ' + err.message); 
        announce('Errore import'); 
      }
    }
  });
  const resetBtn = document.getElementById('resetBtn');
  resetBtn.addEventListener('click', async () => {
    if (await uiConfirm('Resetta tutti i dati locali?')) {
      resetToDefault();
      announce('Dati resettati');
      location.reload();
    }
  });
})();
</script>
</body>
</html>
